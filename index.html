<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>漢方AI診断支援システム</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header class="bg-primary text-white py-3 mb-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="h3 mb-1">
                        <i class="bi bi-herbal"></i>
                        <span data-lang="title">漢方AI診断支援システム</span>
                    </h1>
                    <p class="mb-0 small" data-lang="subtitle">症状を入力して漢方処方の候補を取得</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-light btn-sm" data-lang="ja" onclick="switchLanguage('ja')">日本語</button>
                        <button type="button" class="btn btn-outline-light btn-sm" data-lang="en" onclick="switchLanguage('en')">English</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <!-- Left Column: Input Form -->
            <div class="col-lg-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0" data-lang="form-title">症状入力フォーム</h5>
                    </div>
                    <div class="card-body">
                        <form id="symptom-form" novalidate>
                            <!-- Chief Complaint (Required) -->
                            <div class="mb-3">
                                <label for="chief-complaint" class="form-label" data-lang="chief-complaint-label">主訴 <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="chief-complaint" 
                                       placeholder="例：腰痛、頭痛、不眠など" required
                                       data-lang="chief-complaint-placeholder">
                                <div class="invalid-feedback" data-lang="chief-complaint-error">主訴を入力してください</div>
                                <div class="form-text" data-lang="chief-complaint-help">具体的な症状を簡潔に入力してください</div>
                            </div>

                            <!-- Symptom Tags -->
                            <div class="mb-3">
                                <label class="form-label" data-lang="symptom-tags-label">症状タグ</label>
                                <div class="row" id="symptom-tags-container">
                                    <!-- Dynamic symptom tags will be inserted here -->
                                </div>
                                <div class="form-text" data-lang="symptom-tags-help">該当する症状にチェックを入れてください</div>
                            </div>

                            <!-- Free Text Description -->
                            <div class="mb-3">
                                <label for="free-text" class="form-label" data-lang="free-text-label">詳細症状</label>
                                <textarea class="form-control" id="free-text" rows="3" 
                                          placeholder="その他の症状や経過など詳しく記述してください"
                                          data-lang="free-text-placeholder"></textarea>
                            </div>

                            <!-- Concomitant Medications -->
                            <div class="mb-3">
                                <label for="concomitant-meds" class="form-label" data-lang="concomitant-meds-label">併用薬</label>
                                <input type="text" class="form-control" id="concomitant-meds"
                                       placeholder="例：アスピリン, ロキソニン, 漢方薬など（カンマ区切り）"
                                       data-lang="concomitant-meds-placeholder">
                                <div class="invalid-feedback" data-lang="concomitant-meds-error">使用できない文字が含まれています</div>
                                <div class="form-text" data-lang="concomitant-meds-help">現在服用中の薬剤をカンマ区切りで入力</div>
                            </div>

                            <!-- Consent Checkbox -->
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="consent-check" required>
                                    <label class="form-check-label" for="consent-check">
                                        <span data-lang="consent-text">診断支援システムの利用に同意します</span>
                                        <button type="button" class="btn btn-link btn-sm p-0 ms-2" 
                                                data-bs-toggle="modal" data-bs-target="#terms-modal">
                                            <span data-lang="terms-link">利用規約</span>
                                        </button>
                                        <span class="text-danger">*</span>
                                    </label>
                                </div>
                                <div class="invalid-feedback" data-lang="consent-error">利用規約への同意が必要です</div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button type="button" class="btn btn-outline-secondary" id="clear-btn" data-lang="clear-btn">クリア</button>
                                <button type="submit" class="btn btn-primary" id="submit-btn" data-lang="submit-btn">
                                    <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                                    <span data-lang="submit-text">診断開始</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Right Column: Results -->
            <div class="col-lg-6">
                <div id="results-area">
                    <!-- Initial state message -->
                    <div class="card">
                        <div class="card-body text-center text-muted">
                            <i class="bi bi-clipboard-data display-4 mb-3"></i>
                            <p class="mb-0" data-lang="initial-message">左側のフォームに入力して診断を開始してください</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Terms Modal -->
    <div class="modal fade" id="terms-modal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-lang="terms-title">利用規約</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div data-lang="terms-content">
                        <h6>免責事項</h6>
                        <p>本システムは診断支援ツールであり、医師の診断を代替するものではありません。最終的な診断・治療は必ず医師にご相談ください。</p>
                        
                        <h6>利用上の注意</h6>
                        <ul>
                            <li>入力された情報は診断支援目的でのみ使用されます</li>
                            <li>個人を特定できる情報は収集しません</li>
                            <li>結果は参考情報であり、自己判断での服薬は避けてください</li>
                        </ul>
                        
                        <h6>データの取り扱い</h6>
                        <p>セッション情報はローカルに保存され、外部に送信されることはありません。診断結果の改善のため、匿名化された統計データを収集する場合があります。</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-lang="close-btn">閉じる</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="error-toast" class="toast" role="alert">
            <div class="toast-header">
                <i class="bi bi-exclamation-triangle-fill text-danger me-2"></i>
                <strong class="me-auto" data-lang="error-title">エラー</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="error-message">
                <!-- Error message will be inserted here -->
            </div>
        </div>
        
        <div id="success-toast" class="toast" role="alert">
            <div class="toast-header">
                <i class="bi bi-check-circle-fill text-success me-2"></i>
                <strong class="me-auto" data-lang="success-title">成功</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="success-message">
                <!-- Success message will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light mt-5 py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <p class="mb-1" data-lang="disclaimer">本システムは診断支援ツールです。医師の診断を代替するものではありません。</p>
                    <small class="text-muted" data-lang="contact">お問い合わせ: support@kanpo-ai.example.com</small>
                </div>
                <div class="col-md-4 text-end">
                    <small class="text-muted">
                        <span data-lang="version">バージョン:</span> <span id="app-version">-</span> | 
                        <span data-lang="model">モデル:</span> <span id="model-version">-</span>
                    </small>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="config.js"></script>
    <script src="app.js"></script>
</body>
</html>
